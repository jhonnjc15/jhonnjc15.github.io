---
import { humanize, slugify } from "@lib/utils/textConverter";
import { getRelativeLocaleUrl } from "astro:i18n";
import config from "@config/config.json";

const { categories, basePath = config.settings.blog_folder, labels } = Astro.props;
const params = Astro.params;
const { currentLocale } = Astro;

const normalizedCategories = (categories ?? []).map((category: any) => {
  if (typeof category === "string") {
    return {
      slug: slugify(category),
      label: humanize(category),
    };
  }

  const slugSource = category.slug ?? category.category_name ?? category.name ?? category.label ?? "";
  const labelSource = category.label ?? category.name ?? humanize(slugSource);

  return {
    slug: slugify(slugSource),
    label: labelSource,
  };
});
---

<div class="category-filter mb-10 mt-3 rounded-2xl bg-[#EEEEEE] dark:bg-background-offset/60 p-6 shadow-sm" data-animate="fade-up">
  <div class="mb-3 flex items-center justify-between flex-wrap gap-2">
    <p class="text-sm font-semibold uppercase tracking-[0.2em] text-secondary">{labels?.categories_label}</p>
    <span class="text-xs px-3 py-1 rounded-full bg-primary/10 text-primary font-semibold">{labels?.all_categories_label}</span>
  </div>
  <ul class="filter-list flex flex-wrap items-center gap-2">
    <li>
      <a
        class={`filter-btn ${
          !params.category ? "filter-btn-active" : undefined
        } btn btn-sm`}
        href={getRelativeLocaleUrl(currentLocale ?? '', `/${basePath}`)}>{labels?.all_categories_label}</a
      >
    </li>
    {
      normalizedCategories.map((category: { slug: string; label: string }) => (
        <li>
          <a
            class={`filter-btn ${
              params.category === category.slug
                ? "filter-btn-active"
                : undefined
            } btn btn-sm`}
            href={getRelativeLocaleUrl(
              currentLocale ?? '',
              `/${basePath}/${category.slug}`,
            )}
          >
            {category.label}
          </a>
        </li>
      ))
    }
  </ul>
</div>
