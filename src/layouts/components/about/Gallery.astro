---
import { markdownify } from "@lib/utils/textConverter";
const { gallery } = Astro.props;
const { title, description, images } = gallery;

const defaultSizes = ["tall", "square", "wide", "square", "medium"];

const sizeMap: Record<string, number> = {
  tall: 24,
  square: 18,
  wide: 14,
  medium: 16,
};

const galleryItems = images.map((image: any, index: number) => {
  if (typeof image === "string") {
    const size = defaultSizes[index % defaultSizes.length];
    return {
      src: image,
      alt: title,
      size,
      rows: sizeMap[size] || sizeMap.square,
    };
  }

  const normalizedSize = image.size || defaultSizes[index % defaultSizes.length];

  return {
    ...image,
    size: normalizedSize,
    rows: image.rows || sizeMap[normalizedSize] || sizeMap.square,
  };
});
---

<section class="section">
  <div class="container">
    <div class="row justify-center text-center">
      <div class="col-10 lg:col-8 space-y-3">
        <p class="text-xs uppercase tracking-[0.25em] text-secondary font-semibold" set:html={markdownify(title)} />
        <h2 class="text-3xl md:text-4xl font-extrabold text-default" set:html={markdownify(title)} />
        {description && (
          <p class="text-text-offset leading-relaxed" set:html={markdownify(description)} />
        )}
      </div>
    </div>

    <div class="relative max-w-5xl mx-auto">
      <div
        class="grid auto-rows-[10px] gap-3 sm:gap-4 md:gap-5 lg:gap-5 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 grid-flow-dense"
        id="photo-gallery"
      >
        {galleryItems.map((image) => (
          <div
            class={`picture-item group relative overflow-hidden rounded-xl bg-white/70 shadow-lg shadow-black/5 ring-1 ring-black/10 backdrop-blur`}
            style={{ gridRowEnd: `span ${image.rows || sizeMap[image.size] || sizeMap.square}` }}
          >
            <div class="relative h-full w-full">
              <img
                class="h-full w-full object-cover transition duration-500 ease-out group-hover:scale-[1.03]"
                src={image.src}
                alt={image.alt || title}
                loading="lazy"
              />
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>
