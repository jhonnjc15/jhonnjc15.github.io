---
import { markdownify } from "@lib/utils/textConverter";
const { gallery } = Astro.props;
//console.log(gallery)
const { title, description, images } = gallery;
---

<section class="section">
  <div class="container">
    <div class="row justify-center text-center">
      <div class="col-10 lg:col-8 space-y-3">
        <p class="text-xs uppercase tracking-[0.25em] text-secondary font-semibold" set:html={markdownify(title)} />
        <h2 class="text-3xl md:text-4xl font-extrabold text-default" set:html={markdownify(title)} />
        {description && (
          <p class="text-text-offset leading-relaxed" set:html={markdownify(description)} />
        )}
      </div>
    </div>

    <div class="relative">
      <div class="row" id="photo-gallery">
        {
          images.map((image: any) => (
            <div class="picture-item col-6 mt-12">
              <img class="w-full rounded-2xl aspect-[4/3] object-cover shadow-md" src={image} alt="" loading="lazy" />
            </div>
          ))
        }

        <div class="js-shuffle-sizer col-1"></div>
      </div>
    </div>
  </div>
</section>

<script>
  import Shuffle from "shufflejs";
  function initGallery() {
    const element = document.getElementById("photo-gallery");
    if (!element) return;

    if (element.dataset.shuffleBound === "true") return;
    element.dataset.shuffleBound = "true";

    const sizer = element.querySelector(".js-shuffle-sizer");
    const shuffleInstance = new Shuffle(element, {
      itemSelector: ".picture-item",
      sizer: sizer,
      columnWidth: 1,
    });

    const requestLayout = () => shuffleInstance.layout();
    const images = Array.from(element.querySelectorAll("img"));

    images.forEach((img) => {
      if (img.complete) {
        requestLayout();
      } else {
        img.addEventListener("load", requestLayout, { once: true });
        img.addEventListener("error", requestLayout, { once: true });
      }
    });

    window.addEventListener("resize", requestLayout);
  }

  initGallery();
  document.addEventListener("astro:after-swap", initGallery);
</script>
