---
import { markdownify } from "@lib/utils/textConverter";
const { gallery } = Astro.props;
const { title, description, images } = gallery;

const defaultSizes = ["tall", "square", "wide", "square", "medium"];

const sizeMap: Record<string, number> = {
  tall: 22,
  square: 17,
  wide: 14,
  medium: 15,
};

const heightUnit = 7;

const galleryItems = images.map((image: any, index: number) => {
  if (typeof image === "string") {
    const size = defaultSizes[index % defaultSizes.length];
    const rows = sizeMap[size] || sizeMap.square;
    return {
      src: image,
      alt: title,
      size,
      rows,
      height: rows * heightUnit,
    };
  }

  const normalizedSize = image.size || defaultSizes[index % defaultSizes.length];
  const rows = image.rows || sizeMap[normalizedSize] || sizeMap.square;

  return {
    ...image,
    size: normalizedSize,
    rows,
    height: rows * heightUnit,
  };
});
---

<section class="section">
  <div class="container">
    <div class="row justify-center text-center">
      <div class="col-10 lg:col-8 space-y-3">
        <p class="text-xs uppercase tracking-[0.25em] text-secondary font-semibold" set:html={markdownify(title)} />
        <h2 class="text-3xl md:text-4xl font-extrabold text-default" set:html={markdownify(title)} />
        {description && (
          <p class="text-text-offset leading-relaxed" set:html={markdownify(description)} />
        )}
      </div>
    </div>

    <div class="gallery-shell" id="photo-gallery">
      <div class="masonry">
        {galleryItems.map((image) => (
          <div class={`picture-item group`} style={{ height: `${image.height}px` }}>
            <div class="picture-surface">
              <img
                class="picture-img"
                src={image.src}
                alt={image.alt || title}
                loading="lazy"
              />
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<style lang="scss">
  .gallery-shell {
    position: relative;
    max-width: 62rem;
    margin: 0 auto;
    padding: clamp(0.75rem, 2vw, 1.5rem);
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(240, 244, 255, 0.92));
    border-radius: 20px;
    border: 2px solid rgba(89, 116, 255, 0.16);
    box-shadow: 0 25px 50px -24px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(12, 18, 43, 0.05);
  }

  .masonry {
    column-count: 1;
    column-gap: clamp(0.75rem, 1.5vw, 1.25rem);
  }

  @media (min-width: 640px) {
    .masonry {
      column-count: 2;
    }
  }

  @media (min-width: 1024px) {
    .masonry {
      column-count: 3;
    }
  }

  .picture-item {
    break-inside: avoid;
    margin-bottom: clamp(0.75rem, 1.5vw, 1.25rem);
    border-radius: 16px;
    overflow: hidden;
  }

  .picture-surface {
    position: relative;
    height: 100%;
    width: 100%;
    background: rgba(255, 255, 255, 0.7);
    box-shadow: 0 14px 30px -16px rgba(0, 0, 0, 0.35);
    border: 1px solid rgba(15, 23, 42, 0.06);
    border-radius: inherit;
    overflow: hidden;
  }

  .picture-img {
    height: 100%;
    width: 100%;
    object-fit: cover;
    transition: transform 320ms ease-out;
    display: block;
  }

  .group:hover .picture-img,
  .group:focus-visible .picture-img {
    transform: scale(1.04);
  }
</style>
