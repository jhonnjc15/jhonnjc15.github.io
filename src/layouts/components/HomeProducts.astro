---
import { Image } from "astro:assets";
import { getRelativeLocaleUrl } from "astro:i18n";
import { getProductSlug } from "@lib/utils/productSlug";
import GlowShape from "@layouts/GlowShape.astro";

const { section, products } = Astro.props;
const { currentLocale } = Astro;

const visibleProducts = (products ?? []).filter((item: any) => item.show !== false);
const featuredProducts = visibleProducts.slice(0, 3);

const getMainImage = (item: any) =>
  item.images?.find((img: { isMain?: boolean }) => img.isMain)?.src ?? "/images/default.jpg";
---
<section class="section pt-6 pb-20 lg:pt-10 relative overflow-hidden">
  <GlowShape
    size={160}
    top={-48}
    left={32}
    from="var(--color-secondary)"
    to="#4ade80"
    fromStop={35}
    toStop={70}
    blur={64}
    opacity={0.3}
    skewX={0}
    skewY={0}
  />
  <GlowShape
    size={176}
    bottom={32}
    right={40}
    from="var(--color-primary)"
    to="var(--color-secondary)"
    fromStop={25}
    toStop={75}
    blur={64}
    opacity={0.2}
    dominant="to"
    skewX={0}
    skewY={0}
  />
  <span class="pointer-events-none absolute top-24 right-32 h-24 w-24 rounded-full bg-gradient-to-tr from-primary to-green-400 blur-2xl opacity-25"></span>
  <span class="pointer-events-none absolute bottom-20 left-20 h-28 w-28 rounded-full bg-gradient-to-tr from-secondary to-primary blur-2xl opacity-20"></span>
  <div class="container space-y-10 relative">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="space-y-2">
        <h2 class="text-3xl md:text-4xl font-extrabold text-default">
          {section?.title}
        </h2>
      </div>
      <p class="max-w-2xl text-text-offset leading-relaxed">
        {section?.description}
      </p>
    </div>

    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {
        featuredProducts.map((product: any) => (
          <article class="group relative flex h-full flex-col overflow-hidden rounded-3xl border border-gray-200 bg-background p-5 shadow-lg transition hover:-translate-y-1 hover:shadow-2xl dark:border-gray-700">
            <span class="pointer-events-none absolute -top-6 left-6 h-20 w-20 rounded-full bg-gradient-to-tr from-secondary to-green-400 blur-2xl opacity-30"></span>
            <span class="pointer-events-none absolute bottom-4 right-6 h-24 w-24 rounded-full bg-gradient-to-tr from-primary to-secondary blur-2xl opacity-20"></span>
            <div class="aspect-[4/3] overflow-hidden rounded-2xl bg-background-offset border border-gray-200 dark:border-gray-700">
              <Image
                class="h-full w-full object-cover transition duration-500 group-hover:scale-105"
                width={640}
                height={480}
                src={getMainImage(product)}
                alt={product.name || product.title}
              />
            </div>
            <div class="mt-5 space-y-3 flex flex-col flex-1">
              <h3 class="text-xl font-semibold text-default">
                {product.name || product.title}
              </h3>
              <p class="product-description text-sm leading-relaxed text-text-offset">
                {product.description}
              </p>
              <div class="pt-2 mt-auto flex justify-center">
                <a
                  class="btn btn-outline-primary inline-flex items-center gap-2"
                  href={getRelativeLocaleUrl(currentLocale ?? "", `/products/${getProductSlug(product)}`)}
                >
                  {currentLocale === "en" ? "Discover more" : "Descubrir m√°s"}
                  <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14m-7-7 7 7-7 7" />
                  </svg>
                </a>
              </div>
            </div>
          </article>
        ))
      }
    </div>

    <div class="flex justify-center">
      <a
        class="btn btn-primary"
        href={getRelativeLocaleUrl(currentLocale ?? "", section?.button?.link ?? "/products")}
      >
        {section?.button?.label}
      </a>
    </div>
  </div>
</section>

<style>
  .product-description {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
