---
import { Image } from "astro:assets";
import { getRelativeLocaleUrl } from "astro:i18n";

const { section, products } = Astro.props;
const { currentLocale } = Astro;

const visibleProducts = (products ?? []).filter((item: any) => item.show !== false);
const featuredProducts = visibleProducts.slice(0, 3);

const getMainImage = (item: any) =>
  item.images?.find((img: { isMain?: boolean }) => img.isMain)?.src ?? "/images/default.jpg";
---
<section class="section pt-6 pb-16 lg:pt-10">
  <div class="container space-y-10">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
      <div class="space-y-2">
        <h2 class="text-3xl md:text-4xl font-extrabold text-default">
          {section?.title}
        </h2>
      </div>
      <p class="max-w-2xl text-text-offset leading-relaxed">
        {section?.description}
      </p>
    </div>

    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
      {
        featuredProducts.map((product: any) => (
          <article class="group relative overflow-hidden rounded-3xl border border-gray-200 bg-background p-5 shadow-lg transition hover:-translate-y-1 hover:shadow-2xl dark:border-gray-700">
            <div class="aspect-[4/3] overflow-hidden rounded-2xl bg-background-offset">
              <Image
                class="h-full w-full object-cover transition duration-500 group-hover:scale-105"
                width={640}
                height={480}
                src={getMainImage(product)}
                alt={product.name || product.title}
              />
            </div>
            <div class="mt-5 space-y-3">
              <h3 class="text-xl font-semibold text-default">
                {product.name || product.title}
              </h3>
              <p class="text-sm leading-relaxed text-text-offset">
                {product.description}
              </p>
              <div class="flex flex-wrap gap-2">
                {(product.features ?? []).slice(0, 3).map((feature: string) => (
                  <span class="rounded-full bg-background-offset px-3 py-1 text-xs font-semibold text-text">
                    {feature}
                  </span>
                ))}
              </div>
              <a
                class="inline-flex items-center gap-2 text-sm font-semibold text-primary hover:text-secondary"
                href={getRelativeLocaleUrl(currentLocale ?? "", `/products/${product.id_product}`)}
              >
                {currentLocale === "en" ? "Discover more" : "Descubrir m√°s"}
                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14m-7-7 7 7-7 7" />
                </svg>
              </a>
            </div>
          </article>
        ))
      }
    </div>

    <div class="flex justify-center">
      <a
        class="btn btn-primary"
        href={getRelativeLocaleUrl(currentLocale ?? "", section?.button?.link ?? "/products")}
      >
        {section?.button?.label}
      </a>
    </div>
  </div>
</section>
