---
import { Image } from 'astro:assets';
import config from "@config/config.json";
import dateFormat from "@lib/utils/dateFormat";
import readingTime from "@lib/utils/readingTime";
import Disqus from "./function-components/Disqus";
import ProductBreadcrumb from "./components/products/ProductBreadcrumb.astro";

import { humanize, slugify } from "@lib/utils/textConverter";
import { getRelativeLocaleUrl } from "astro:i18n";
import categoriesES from "@data/es/blog-categories.json";
import categoriesEN from "@data/en/blog-categories.json";
const { blog_folder } = config.settings;
const { currentLocale } = Astro;
import {
  FaRegCalendarAlt,
  FaRegClock,
  FaRegFolder,
  FaRegUserCircle,
} from "react-icons/fa/index.js";

const { post } = Astro.props;
const { Content } = await post.render();
const categoryEntries = currentLocale === "en" ? categoriesEN : categoriesES;
const primaryCategory = post.data.categories?.[0];
const categoryEntry = primaryCategory
  ? categoryEntries.find((entry) => entry.category_name === primaryCategory)
  : undefined;
const categoryTitle = categoryEntry?.name ?? (primaryCategory ? humanize(primaryCategory) : undefined);
const categoryPath = primaryCategory ? `${blog_folder}/${slugify(primaryCategory)}` : undefined;
const breadcrumbData = {
  title: post.data.title,
  page_title: post.data.title,
  index_title: currentLocale === "en" ? "Blog" : "Blog",
  index_path: blog_folder,
  category_title: categoryTitle,
  category_path: categoryPath,
};
---

<section class="section blog-single relative overflow-hidden">
  <span class="absolute top-[500px] left-0 w-[360px] h-[220px] bg-gradient-to-tr from-secondary to-green-400 rounded-full blur-3xl opacity-25"></span>
  <span class="absolute top-0 right-8 w-[260px] h-[120px] bg-gradient-to-tr from-secondary to-green-400 rounded-full blur-3xl opacity-25"></span>
  <span class="absolute bottom-0 right-10 w-[240px] h-[180px] bg-gradient-to-tr from-primary to-green-400 rounded-full blur-2xl opacity-25"></span>
  <div class="container relative">
    <div class="mb-8 w-full">
      <ProductBreadcrumb data={breadcrumbData} />
    </div>
    <div class="row justify-center">
      <div class="lg:col-10" data-animate="zoom-in">
        <div class="relative overflow-hidden rounded-3xl shadow-2xl aspect-[16/9] bg-background-offset">
          <Image
            class="h-full w-full object-cover"
            src={post.data.image}
            alt={post.data.title}
            width={1280}
            height={720}
          />
        </div>
      </div>
      <div class="mt-10 max-w-[900px] lg:col-9" data-animate="fade-up">
        <h1 class="h2 text-4xl md:text-5xl font-extrabold leading-tight">
          {post.data.title}
        </h1>
        <div class="mb-5 mt-6 flex items-center space-x-2 text-text-offset">
          <ul class="mb-4 flex flex-wrap items-center gap-x-4 gap-y-2">
            <li class="inline-flex items-center">
              <FaRegUserCircle className={"mr-2 -mt-1 inline-block"} />
              {humanize(post.data.author)}
            </li>

            <li class="inline-flex items-center">
              <FaRegCalendarAlt className={"mr-2 -mt-1 inline-block"} />
              {dateFormat(post.data.date)}
            </li>
            <li class="inline-flex items-center">
              <FaRegClock className={"mr-2 -mt-1 inline-block"} />
              {readingTime(post.body)}
            </li>
            <li class="inline-flex items-center gap-2">
              <FaRegFolder className={"-mt-1 inline-block"} />
              {
                post.data.categories.map((category: string, index: number) => (
                  <a
                    href={getRelativeLocaleUrl(
                      currentLocale ?? '',
                      `/${blog_folder}/${slugify(category)}`,
                    )}
                    class="hover:text-primary"
                  >
                    {humanize(category)}
                    {index !== post.data.categories.length - 1 && ","}
                  </a>
                ))
              }
            </li>
          </ul>
        </div>

        <div
          class="content prose prose-neutral max-w-none dark:prose-invert prose-a:text-primary dark:prose-a:text-primary"
          data-animate="fade-up"
        >
          <Content />
        </div>
        <!-- <Disqus client:load /> -->
      </div>
    </div>
  </div>
</section>
